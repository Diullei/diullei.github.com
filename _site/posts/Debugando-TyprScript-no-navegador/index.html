<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <meta charset="utf-8">
  <title>
    
      Debugando TypeScript no navegador &ndash;
    
    Diullei Gomes
  </title>

  <meta name="author" content="Diullei Gomes" />
  <meta name="description" content="Coder, hacker and more..." />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <link rel="alternate" type="application/rss+xml" href="/atom.xml" />

  <link rel="stylesheet" href="/css/fontawesome.min.css" type="text/css" media="screen, projection" />
  <link rel="stylesheet" href="/css/base.css" type="text/css" media="screen, projection" />
  <link rel="stylesheet" href="/css/pygments.css" type="text/css" />
  <link media="only screen and (max-device-width: 480px)" href="/css/mobile.css" type="text/css" rel="stylesheet" />
  <link media="only screen and (device-width: 768px)" href="/css/mobile.css" type="text/css" rel="stylesheet" />
  <link href='http://fonts.googleapis.com/css?family=Yanone+Kaffeesatz' rel='stylesheet' type='text/css'>
  <link rel="apple-touch-icon" href="/apple-touch-icon.png" />

  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
  <script type="text/javascript" src="/js/application.js"></script>
</head>

<body>
  <section class="sidebar">
    <a href="/">
      <img src="http://gravatar.com/avatar/5e93890c5b54d18dd454f14789c2b225?s=150" height="75" width="75" class="avatar" />
    </a>

    <section class="name">
      <a href="/">
        <span id="fname">Diullei</span>
        <span id="lname">Gomes</span>
      </a>
    </section>

    <section class="meta">
      <a href="https://github.com/Diullei" target="_blank"><i class="icon icon-github"></i></a>
      <a href="https://twitter.com/diullei" target="_blank"><i class="icon icon-twitter"></i></a>
      <a href="/atom.xml"><i class="icon icon-rss"></i></a>
    </section>

    <section class="sections">
      <ul>
        <li><a href="/archive.html">Artigos</a></li>
        <li><a href="/categories.html">Categorias</a></li>
        <li><a href="/tags.html">Tags</a></li>
        <li><a href="/about.html">Sobre mim</a></li>
      </ul>
    </section>
  </section>

  <section class="content">
  <h1>
    <a href="/posts/Debugando-TyprScript-no-navegador">Debugando TypeScript no navegador</a>
  </h1>

  <section class="byline">
    October 16, 2012
  </section>

  <h2>Introdução</h2>

<p>Existe um recurso bem interessante implementado no Firefox e no Chrome (não sei ao certo quais outros navegadores) chamado <a href="http://www.html5rocks.com/en/tutorials/developertools/sourcemaps/">Source Maps</a>. Para entender do que se trata tenha em mente um arquivo javascript minificado. Para rastrear um bug no código deste arquivo por exemplo teríamos que usar a versão não minificada do mesmo. Uma vez encontrado o bug este seria corrigido e um novo arquivo minificado seria gerado. Um Source Map é um arquivo de mapeamento que faz um dê-para (no nosso caso) do arquivo minificado com o arquivo real. A partir deste mapeamento o browser consegue realizar o debug no arquivo original(não minificado) em bora a execução real esteja ocorrendo no arquivo minificado.</p>

<p>Até aqui isso não agregou muito por que basta referenciar o arquivo original como dito anteriormente. Uma vez que tenhamos o problema rastreado ou a feature implementada minificamos tudo novamente.</p>

<h3>Como isso pode nos ajudar no Debug de código TypeScript?</h3>

<p>TypeScrit assim como CoffeeScrit e Dart entre outros são pré-processadores que geram no final das contas código JavaScript. Como a maioria dos pré-processadores tenta melhorar a sintaxe do código na escrita de expressões lambda, iterações, classes, interfaces, heranças e etc, temos uma dissonância entre o código escrito em TypeScript por exemplo com o código JavaScript gerado no final.</p>

<p>Aqui entra em ação o Source Map. Com ele assim como podemos mapear um arquivo minificado com seu arquivo original, podemos também mapear um arquivo TypeScript original com seu código final gerado em JavaScript. Isso abre novas possibilidades de debug. Novas ferramentas de debug e refatoração podem ser criadas a partir deste recurso.</p>

<p>É aí que entra o assunto deste artigo. Vou mostrar como debugar TypeScript em um navegador com suporte a Source Maps. No meu caso vamos usar o Chrome.</p>

<h2>Habilitando Source Map no Google Chrome</h2>

<p>Para habilitar o recurso de source maps no Chrome basta acessar Settings e selecionar a caixa &ldquo;Enable source maps&rdquo;. Veja na imagem abaixo:</p>

<p><img src="/images/debug_typescript/enable_source_map.png" alt="Valid XHTML" /></p>

<p>Feito isso estamos pronto para debugar nosso código.</p>

<h2>Criando o nosso código de testes</h2>

<p>Para exemplo vamos criar um arquivo com um código TypeScript muito simples. Salve o código abaixo em um arquivo chamado <code>script.ts</code>.</p>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><code class="javascript"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</code></pre></div></td><td class="code"><div class="highlight"><pre><span class="kr">interface</span> <span class="nx">IPessoa</span><span class="p">{</span>
    <span class="nx">nome</span><span class="o">:</span> <span class="nx">string</span><span class="p">;</span>
    <span class="nx">sobreNome</span><span class="o">:</span> <span class="nx">string</span><span class="p">;</span>
    <span class="nx">nomeCompleto</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">string</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">class</span> <span class="nx">Pessoa</span> <span class="kr">implements</span> <span class="nx">IPessoa</span> <span class="p">{</span>
    <span class="nx">nome</span><span class="o">:</span> <span class="nx">string</span><span class="p">;</span>
    
    <span class="nx">sobreNome</span><span class="o">:</span> <span class="nx">string</span><span class="p">;</span>

    <span class="nx">nomeCompleto</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s2">&quot;Nome: &quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">nome</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">sobreNome</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">pessoa</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Pessoa</span><span class="p">();</span>
<span class="nx">pessoa</span><span class="p">.</span><span class="nx">nome</span> <span class="o">=</span> <span class="s2">&quot;Diullei&quot;</span><span class="p">;</span>
<span class="nx">pessoa</span><span class="p">.</span><span class="nx">sobreNome</span> <span class="o">=</span> <span class="s2">&quot;Gomes&quot;</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">element</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">);</span>

<span class="nx">element</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">pessoa</span><span class="p">.</span><span class="nx">nomeCompleto</span><span class="p">();</span>
</pre></div>
</td></tr></table>


<p>Agora crie um arquivo chamado <code>index.html</code> e coloque o código abaixo:</p>

<div class="highlight"><pre><code class="html"><span class="cp">&lt;!DOCTYPE HTML&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta&gt;</span>
    <span class="nt">&lt;title&gt;&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;content&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src=</span><span class="s">&quot;script.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>


<p>Estes arquivos precisam estar no mesmo folder.</p>

<h2>Source Maps para TypeScript</h2>

<p>Tendo nosso pequeno projeto em mãos agora precisamos gerar nosso arquivo source map. Felizmente o time que trabalha no TypeScript fez um trabalho muito bom incluindo um gerador de source maps no <a href="http://typescript.codeplex.com/SourceControl/changeset/view/d397c54a55db#src%2fcompiler%2fsourceMapping.ts">compilador do TypeScript</a>. Embora não seja documentado no help do utilitário de compilação do TypeScript para gerar o arquivo sourcemap basta executar a compilação da seguinte forma: <code>tsc --sourcemap script.ts</code>. Feito isso repare que um arquivo chamado <code>script.js.map</code> é gerado. Repare também que este arquivo é referenciado no final do arquivo script.js gerado pelo compilador como na linha abaixo:</p>

<p><code>//@ sourceMappingURL=script.js.map</code></p>

<p>Tendo compilado o arquivo script.ts agora basta abrir a página <code>index.html</code> no Chrome. Coloque um breakpoint no código para ver o debug do TypeScript em ação. Veja na imagem abaixo:</p>

<p><img src="/images/debug_typescript/debug.png" alt="Valid XHTML" /></p>

<h2>Conclusão</h2>

<p>Como vimos o recurso Source Maps abre muitas possibilidades no tocante a rastreamento de código.</p>

<ul>
<li>Para saber mais sobre Source Maps acesse <a href="http://www.html5rocks.com/en/tutorials/developertools/sourcemaps/">http://www.html5rocks.com/en/tutorials/developertools/sourcemaps/</a></li>
<li>Para saber mais sobre TypeScript acesse <a href="http://diullei.github.com/TypeScript-ptBR/">http://diullei.github.com/TypeScript-ptBR/</a></li>
</ul>


<p>Um grande abraço e até a próxima!</p>


  <hr/>

  <section class="meta">
    <section class="copy">
      <a href="https://twitter.com/diullei" target="_blank">
        <img src="http://gravatar.com/avatar/5e93890c5b54d18dd454f14789c2b225?s=142" height="50" width="50" />
      </a>

      <p>
        Cristão, Programador .NET apaixonado por Desenvolvimento de Software. TypeScript entusiasta - <a href="https://github.com/borisyankov/DefinitelyTyped" target="_blank">DefinitelyTyped</a> collaborator.
      </p>

      <a href="http://twitter.com/share" class="twitter-share-button" data-count="none" data-via="diullei">Tweet</a>
      <a href="http://twitter.com/diullei" class="twitter-follow-button" data-show-count="false">Follow @diullei</a>
      <script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
    </section>
  </section>

  <hr/>

   <div id="disqus_thread"></div>
   <script>
    var disqus_shortname = 'diulleigomes';
    var disqus_identifier = 'Debugando TypeScript no navegador';
    var disqus_title = 'Debugando TypeScript no navegador';
    var disqus_message = 'Debugando TypeScript no navegador';
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
   </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

</section>
</body>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-33515162-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</html>
