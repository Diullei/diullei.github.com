<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <meta charset="utf-8">
  <title>
    
      Arrays tipados - ES6 &ndash;
    
    Diullei Gomes
  </title>

  <meta name="author" content="Diullei Gomes" />
  <meta name="description" content="Coder, hacker and more..." />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <link rel="alternate" type="application/rss+xml" href="/atom.xml" />

  <link rel="stylesheet" href="/css/fontawesome.min.css" type="text/css" media="screen, projection" />
  <link rel="stylesheet" href="/css/base.css" type="text/css" media="screen, projection" />
  <link rel="stylesheet" href="/css/pygments.css" type="text/css" />
  <link media="only screen and (max-device-width: 480px)" href="/css/mobile.css" type="text/css" rel="stylesheet" />
  <link media="only screen and (device-width: 768px)" href="/css/mobile.css" type="text/css" rel="stylesheet" />
  <link href='http://fonts.googleapis.com/css?family=Yanone+Kaffeesatz' rel='stylesheet' type='text/css'>
  <link rel="apple-touch-icon" href="/apple-touch-icon.png" />

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.5.0/styles/default.min.css" type="text/css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.5.0/styles/monokai-sublime.min.css" type="text/css" />
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
  <script type="text/javascript" src="/js/application.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.5.0/highlight.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.5.0/languages/typescript.min.js"></script>
</head>

<body>
  <div id="page-wrap">
    <section class="sidebar">
      <a href="/">
        <img src="http://gravatar.com/avatar/5e93890c5b54d18dd454f14789c2b225?s=150" height="75" width="75" class="avatar" />
      </a>

      <section class="name">
        <a href="/">
          <span id="fname">Diullei</span>
          <span id="lname">Gomes</span>
        </a>
      </section>

      <section class="meta">
        <a href="https://github.com/Diullei" target="_blank"><i class="icon icon-github"></i></a>
        <a href="https://twitter.com/diullei" target="_blank"><i class="icon icon-twitter"></i></a>
        <a href="/atom.xml"><i class="icon icon-rss"></i></a>
      </section>

      <section class="sections">
        <ul>
          <li><a href="/archive.html">Artigos</a></li>
          <li><a href="/categories.html">Categorias</a></li>
          <li><a href="/tags.html">Tags</a></li>
          <li><a href="/about.html">Sobre mim</a></li>
        </ul>
      </section>

      <section>
        <img src="/images/ts-es6.jpg" style="margin-top: 25px;" height="75" width="75" class="ts-es6" />
      </section>

    </section>

    <section class="content">
  <h1>
    <a href="/posts/Arrays-tipados-ES6">Arrays tipados - ES6</a>
  </h1>

  <section class="byline">
    October 28, 2016
  </section>

  <p>Os arrays tipados são parte da especificação do ECMAScript 2015 (também conhecido como ES6). Eles foram projetados para facilitar o trabalho com estruturas de dados binárias. Inicialmente os arrays tipados foram introduzidos pelas APIs WebGL com o objetivo de diminuir a dissonância entre as estruturas de dados padrões do <code>JavaScript</code> e as estruturas de dados do <code>C</code>, linguagem base da API <code>WebGL</code>, e com isso permitir ao JavaScript acessar diretamente a estrutura já alocada em memória.</p>

<p>Você pode acessar este <a href="http://caniuse.com/#feat=typedarrays">link</a> para saber quais browsers já suportam esse recurso: <a href="http://caniuse.com/#feat=typedarrays">http://caniuse.com/#feat=typedarrays</a></p>

<h2>Criando Arrays tipados</h2>

<p>Aqui não existe nenhum segredo, criamos um array tipado da mesma forma que criarpiamos qualquer instância de objeto. em JavaScript:</p>

<pre><code class="javascript">var arr = new Uint16Array(10);
arr[0] = 0xFFFF;
console.log(arr[0]);
</code></pre>

<p>O argumento passado no construtor define o número de elementos que estamos alocando neste array (No exemplo acima estamos alocando 10 elementos do tipo numérico <code>uint16</code>, o que de acordo com a especificação deste tipo de array irá alocar 20 bytes de memória).</p>

<p>Veja abaixo uma lista com os tipos de arrays tipados disponíveis:</p>

<table>
<thead>
<tr>
<th style="text-align:left;"> Tipo                </th>
<th style="text-align:center;"> Tamanho (byte)   </th>
<th style="text-align:left;"> Tipo correspondente em C </th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;"> <code>Int8Array</code>         </td>
<td style="text-align:center;">  1               </td>
<td style="text-align:left;"> int8_t    </td>
</tr>
<tr>
<td style="text-align:left;"> <code>Uint8Array</code>        </td>
<td style="text-align:center;">  1               </td>
<td style="text-align:left;"> uint8_t   </td>
</tr>
<tr>
<td style="text-align:left;"> <code>Uint8ClampedArray</code> </td>
<td style="text-align:center;">  1               </td>
<td style="text-align:left;"> uint8_t   </td>
</tr>
<tr>
<td style="text-align:left;"> <code>Int16Array</code>        </td>
<td style="text-align:center;">  2               </td>
<td style="text-align:left;"> int16_t   </td>
</tr>
<tr>
<td style="text-align:left;"> <code>Uint16Array</code>       </td>
<td style="text-align:center;">  2               </td>
<td style="text-align:left;"> uint16_t  </td>
</tr>
<tr>
<td style="text-align:left;"> <code>Int32Array</code>        </td>
<td style="text-align:center;">  4               </td>
<td style="text-align:left;"> int32_t   </td>
</tr>
<tr>
<td style="text-align:left;"> <code>Uint32Array</code>       </td>
<td style="text-align:center;">  4               </td>
<td style="text-align:left;"> uint32_t  </td>
</tr>
<tr>
<td style="text-align:left;"> <code>Float32Array</code>      </td>
<td style="text-align:center;">  4               </td>
<td style="text-align:left;"> float     </td>
</tr>
<tr>
<td style="text-align:left;"> <code>Float64Array</code>      </td>
<td style="text-align:center;">  8               </td>
<td style="text-align:left;"> double    </td>
</tr>
</tbody>
</table>


<h2>ArrayBuffer e DataView</h2>

<p><code>ArrayBuffer</code> e <code>DataView</code> são parte da implementação de arrays tipados. Um <code>ArrayBuffer</code> básicamente armazena os dados de um array tipado. Por exemplo:</p>

<pre><code class="javascript">var fileArrayBuffer = reader.readAsArrayBuffer(file);
</code></pre>

<p>Neste código <code>ArrayBuffer</code> ira armazenar todos os bytes do arquivo. Como esse arquivo pode estar em encodes diferentes, precisaremos fazer alguma manipulação para ler seu conteúdo. Por exemplo, se este arquivo for do tipo <code>UTF-8</code> poderemos associar este <code>ArrayBuffer</code> ao tipo <code>Uint16Array</code> para ler corretamente seu conteúdo.</p>

<pre><code class="javascript">var arr = new Uint16Array(fileArrayBuffer);
String.fromCharCode(arr[0]); // A
</code></pre>

<p>Já o <code>DataView</code> é um tipo que nos permite acessar estruturas binrias em memória. Exemplo, se tivermos uma estrutura em <code>C</code> declarada da seguinte forma:</p>

<pre><code class="c">struct data {
    unsigned int id;
    char[10] username;
}
</code></pre>

<p>Iremos ler esta estrutura em JavaScript com o código:</p>

<pre><code class="javascript">var buf = new ArrayBuffer(11);
var id = new Uint8Array(buf, 0, 1);
var username = new Uint8Array(buf, 1, 10);
</code></pre>

<p>Note que se trata de uma leitura sequencial da memória onde o primeiro byte contém o valor de <code>id</code> e os outros 10 bytes seguintes o valor de <code>username</code>. Aqui estamos utilizando <code>Uint8Array</code> como <code>DataView</code>.</p>

<h2>Onde esse recurso ja está sendo utilizado?</h2>

<ul>
<li><strong>WebGL</strong> - Utiliza typed arrays em buffer, pixels e mapas de testuras</li>
<li><strong>Canvas</strong> - Canvas utiliza um arrau tipado para armazenar uma imagem.</li>
</ul>


<pre><code class="javascript">var uint8ClampedArray = ctx.getImageData(...).data;
</code></pre>

<ul>
<li><strong>WebSockets</strong> - Uma vez habilitado permite a transferência de dados utilizando um <code>ArrayBuffer</code>.</li>
</ul>


<pre><code class="javascript">webSocket.binaryType = 'arraybuffer';
</code></pre>

<ul>
<li><strong>Outras APIs</strong> - <em>File API</em>, <em>XMLHttpRequest,</em> <em>Fetch API</em>, <code>window.postMessage()</code> entre outros.</li>
</ul>


<h2>Conclusão</h2>

<p>Iremos utilizar os Arrays typados em trechos de código muito específicos onde a performance com a manipulação de estruturas de dados mais complexas for importante, como por exemplo a manipulação de imagens e de som.</p>

<p>É isso, até a próxima.</p>


  <hr/>
  <section class="meta">
    <section class="copy">
      <a href="https://twitter.com/diullei" target="_blank">
        <img src="http://gravatar.com/avatar/5e93890c5b54d18dd454f14789c2b225?s=142" height="50" width="50" />
      </a>

      <p>
        Programador .NET - TypeScript - JavaScript - Membro dos times
        <a href="https://github.com/DefinitelyTyped" target="_blank">DefinitelyTyped</a> e
        <a href="https://github.com/TypeStrong" target="_blank">TypeStrong</a>.
      </p>

      <a href="http://twitter.com/share" class="twitter-share-button" data-count="none" data-via="diullei">Tweet</a>
      <a href="http://twitter.com/diullei" class="twitter-follow-button" data-show-count="false">Follow @diullei</a>
      <script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
    </section>
  </section>
  <hr/>
</section>

  </div>
</body>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-33515162-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
<script>hljs.initHighlightingOnLoad();</script>
</html>
