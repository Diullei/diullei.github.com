<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <meta charset="utf-8">
  <title>
    
      Definindo o tipo de "this" em funções &ndash;
    
    Diullei Gomes
  </title>

  <meta name="author" content="Diullei Gomes" />
  <meta name="description" content="Coder, hacker and more..." />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <link rel="alternate" type="application/rss+xml" href="/atom.xml" />

  <link rel="stylesheet" href="/css/fontawesome.min.css" type="text/css" media="screen, projection" />
  <link rel="stylesheet" href="/css/base.css" type="text/css" media="screen, projection" />
  <link rel="stylesheet" href="/css/pygments.css" type="text/css" />
  <link media="only screen and (max-device-width: 480px)" href="/css/mobile.css" type="text/css" rel="stylesheet" />
  <link media="only screen and (device-width: 768px)" href="/css/mobile.css" type="text/css" rel="stylesheet" />
  <link href='http://fonts.googleapis.com/css?family=Yanone+Kaffeesatz' rel='stylesheet' type='text/css'>
  <link rel="apple-touch-icon" href="/apple-touch-icon.png" />

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.5.0/styles/default.min.css" type="text/css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.5.0/styles/monokai-sublime.min.css" type="text/css" />
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
  <script type="text/javascript" src="/js/application.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.5.0/highlight.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.5.0/languages/typescript.min.js"></script>
</head>

<body>
  <div id="page-wrap">
    <section class="sidebar">
      <a href="/">
        <img src="http://gravatar.com/avatar/5e93890c5b54d18dd454f14789c2b225?s=150" height="75" width="75" class="avatar" />
      </a>

      <section class="name">
        <a href="/">
          <span id="fname">Diullei</span>
          <span id="lname">Gomes</span>
        </a>
      </section>

      <section class="meta">
        <a href="https://github.com/Diullei" target="_blank"><i class="icon icon-github"></i></a>
        <a href="https://twitter.com/diullei" target="_blank"><i class="icon icon-twitter"></i></a>
        <a href="/atom.xml"><i class="icon icon-rss"></i></a>
      </section>

      <section class="sections">
        <ul>
          <li><a href="/archive.html">Artigos</a></li>
          <li><a href="/categories.html">Categorias</a></li>
          <li><a href="/tags.html">Tags</a></li>
          <li><a href="/about.html">Sobre mim</a></li>
        </ul>
      </section>

      <section>
        <img src="/images/ts-es6.jpg" style="margin-top: 25px;" height="75" width="75" class="ts-es6" />
      </section>

    </section>

    <section class="content">
  <h1>
    <a href="/posts/Type-of-this-for-functions">Definindo o tipo de "this" em funções</a>
  </h1>

  <section class="byline">
    October 27, 2016
  </section>

  <p>O TypeScript 2.0 nos permite definir o tipo da referência <code>this</code> dentro de uma função. Como sempre, para entender melhor, vamos aos exemplos:</p>

<pre><code class="typescript">class Test {
    public doSomething() {
        let self = this;
    }
}
</code></pre>

<p>Na função <code>doSomething()</code> a variavel <code>self</code> assume o tipo <code>Test</code>. Até aqui nada novo. Agora vamos a outro exemplo:</p>

<pre><code class="typescript">function doSomething() {
    let self = this;
}
</code></pre>

<p>Na função <code>doSomething()</code> acima a variável <code>self</code> assume o tipo <code>any</code>. Isso por que se trata de uma função isolada, fora de uma classe. O que acontece é que agora com a nova versão do TypeScript podemos definir o tipo de <code>this</code> para funções isoladas. Vamos tomar como base a função <code>doSomething()</code>. Digamos que queiramos impedir que um desenvolvedor, por engano, tente chamar qualquer método ou atributo de <code>this</code> dentro desta função. Para isso vamos reescrever essa função da seguinte forma:</p>

<pre><code class="typescript">function doSomething(this: void) {
    let self = this;
}
</code></pre>

<p>Agora o tipo de <code>self</code> é <code>void</code>. Como <code>void</code> não poss membros, caso alguem tente chamar qualquer um de seus membros por engano um erro será exibido em tempo de compilação. Utilizamos uma nova notação onde criamos um argumento chamado <code>this</code> e definimos seu tipo. Esse argumento precisa ser sempre o primeiro argumento dentro da função e ele não será repassado para o código final servindo apenas para informar ao compilador o tipo que queremos definir para <code>this</code>.</p>

<p>Agora vamos a um exemplo mais prático. Veja a seguinte interface:</p>

<pre><code class="typescript">interface UIElement {
    addClickListener(onclick: (this: void, e: Event) =&gt; void): void;
}
</code></pre>

<p>Note que a função <code>addClickListener(...)</code> espera uma outra função como parâmetro que não utilize <code>this</code> no seu bloco de código. Se temtarmos passar uma função que viole essa definição teremos um erro:</p>

<pre><code class="typescript">interface UIElement {
    addClickListener(onclick: (this: void, e: Event) =&gt; void): void;
}

var uiElement: UIElement = &lt;any&gt;{};

class Handler {
    info: string;
    onClickBad(this: Handler, e: Event) {
        this.info = "message";
    };
}
let h = new Handler();
uiElement.addClickListener(h.onClickBad); // erro!
</code></pre>

<p>Veja que dentro da função <code>onClickBad()</code> estamos usando <code>this</code> normalmente. Mas se tentarmos passar a função <code>onClickBad</code> como argumento em <code>addClickListener(...)</code>&hellip;</p>

<pre><code class="typescript">uiElement.addClickListener(h.onClickBad); // erro!
</code></pre>

<p>&hellip;teremos um erro de compilação.</p>

<blockquote><p>NOTA: Para utilizar este recurso precisamos habilitar a chave <code>--noImplicitThis</code> bo arquivo <code>tsconfig.json</code> ou passando diretamente via linha de comando.</p></blockquote>

<p>É isso. Até a próxima.</p>

<blockquote><p>Reference: TS v2.0 <a href="https://github.com/Microsoft/TypeScript/issues/3694">issues/3694</a> e <a href="https://github.com/Microsoft/TypeScript/pull/4910">pull/4910</a></p></blockquote>


  <hr/>
  <section class="meta">
    <section class="copy">
      <a href="https://twitter.com/diullei" target="_blank">
        <img src="http://gravatar.com/avatar/5e93890c5b54d18dd454f14789c2b225?s=142" height="50" width="50" />
      </a>

      <p>
        Programador .NET - TypeScript - JavaScript - Membro dos times
        <a href="https://github.com/DefinitelyTyped" target="_blank">DefinitelyTyped</a> e
        <a href="https://github.com/TypeStrong" target="_blank">TypeStrong</a>.
      </p>

      <a href="http://twitter.com/share" class="twitter-share-button" data-count="none" data-via="diullei">Tweet</a>
      <a href="http://twitter.com/diullei" class="twitter-follow-button" data-show-count="false">Follow @diullei</a>
      <script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
    </section>
  </section>
  <hr/>
</section>

  </div>
</body>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-33515162-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
<script>hljs.initHighlightingOnLoad();</script>
</html>
