function resp(e,t){if(e>360)t.removeClass("m").removeClass("s");else if(e>250&&e<360)t.addClass("m").removeClass("s");else if(e>100&&e<250)t.addClass("s").removeClass("m")}function paintChart(e,t){var n=$('<div class="sector"></div>');n.css(offset(e.os));t.append(n);n.data("val",e.val).data("per",e.per).data("title",e.nm);n.attr("per",e.per);var r=t.height();var i=$('<div class="sector-s"></div>');var s=$('<div class="sector-f"></div>');i.css(percentToPie(e,r).second);s.css(percentToPie(e,r).first);s.append(i);n.append(s);if(e.per>50&&e.per<=100){var o=$('<div class="sector-f"></div>');o.append('<div class="sector-s" style="background-color:'+e.color+'"></div>');o.css({clip:"rect("+0+"px, "+r+"px, "+r+"px, "+r/2+"px)"});n.append(o)}}function hoverState(){$(this).parents(".sector").toggleClass("hover")}function clickState(){var e=$(this).parents(".sector");var t=e.parents(".piechart-flatmin").find(".piehole").find(".piehole-text");var n=e.parents(".piechart-flatmin").data("value");var r=e.parents(".piechart-flatmin").data("key");t.find(".flatmin-value").text(e.data("val")+" "+n);t.find(".flatmin-percentage").text(Math.round(e.data("per")*100)/100);t.find(".flatmin-title").text(e.data("title"));t.fadeIn()}function resizeEvent(){$(".piechart-flatmin").each(function(){var e=$(this);resp(e.width(),e)});$(".piechart-flatmin").find(".sector").each(function(){var e=$(this);var t={per:e.data("per")};var n=e.width();e.find(".sector-f").eq(0).css(percentToPie(t,n).first).find(".sector-s").css(percentToPie(t,n).second);if(t.per>50&&t.per<=100){e.find(".sector-f").eq(1).css({clip:"rect("+0+"px, "+n+"px, "+n+"px, "+n/2+"px)"})}})}function offset(e){var t={transform:"rotate("+e+"deg)","-ms-transform":"rotate("+e+"deg)","-webkit-transform":"rotate("+e+"deg)"};return t}function percentToPie(e,t){var n;var r;var i={};if(e.per<=25){e.per+=.5;i.scliptop=0;i.sclipright=t;i.sclipbottom=t/2;i.sclipleft=t/2;i.srotate=-90+360*(e.per/100);i.fcliptop=0;i.fclipright=t;i.fclipbottom=t/2;i.fclipleft=t/2}else if(e.per>25&&e.per<=50){e.per+=.5;i.scliptop=0;i.sclipright=t;i.sclipbottom=t;i.sclipleft=t/2;i.srotate=-180+360*(e.per/100);i.fcliptop=0;i.fclipright=t;i.fclipbottom=t;i.fclipleft=t/2}else if(e.per>50&&e.per<=75){e.per+=.5;i.scliptop=0;i.sclipright=t;i.sclipbottom=t;i.sclipleft=t/2;i.srotate=-180+360*((e.per-50)/100);i.fcliptop=0;i.fclipright=t;i.fclipbottom=t;i.fclipleft=t/2;i.frotate=179}else if(e.per>75&&e.per<=100){e.per+=.5;i.scliptop=0;i.sclipright=t;i.sclipbottom=t;i.sclipleft=t/2;i.srotate=-360+360*(e.per/100);i.fcliptop=0;i.fclipright=t;i.fclipbottom=t;i.fclipleft=t/2;i.frotate=179}r={second:{clip:"rect("+i.scliptop+"px, "+i.sclipright+"px, "+i.sclipbottom+"px, "+i.sclipleft+"px)",transform:"rotate("+i.srotate+"deg)","-ms-transform":"rotate("+i.srotate+"deg)","-webkit-transform":"rotate("+i.srotate+"deg)",background:e.color},first:{clip:"rect("+i.fcliptop+"px, "+i.fclipright+"px, "+i.fclipbottom+"px, "+i.fclipleft+"px)"}};if(e.per>50&&e.per<=100){r.first={clip:"rect("+i.fcliptop+"px, "+i.fclipright+"px, "+i.fclipbottom+"px, "+i.fclipleft+"px)",transform:"rotate("+i.frotate+"deg)","-ms-transform":"rotate("+i.frotate+"deg)","-webkit-transform":"rotate("+i.frotate+"deg)"}}return r}function totalValue(e){var t=0;$.each(e,function(e,n){if(typeof n[1]=="number")t+=n[1]});return t}function get_random_color(){var e=["#2ecc71","#3498db","#9b59b6","#e74c3c","#e67e22","#34495e","#8e44ad","#27ae60"];ci++;if(ci>e.length-1){ci=0}console.log(ci);return e[ci]}var ci=-1;$(document).ready(function(){$(".piechart-flatmin").on("mouseenter",".sector-s",hoverState);$(".piechart-flatmin").on("mouseleave",".sector-s",hoverState);$(".piechart-flatmin").on("click",".sector-s",clickState);$(window).resize(resizeEvent)});(function(e){e.fn.piechart=function(t){chart={};var n=e('<div class="piechart-flatmin"></div>');n.data("value",t[0][1]).data("key",t[0][0]);t.splice(0,1);var r=e('<div class="piehole"></div>');r.css({background:this.getBackground()});r.append('<div class="piehole-text"><p class="flatmin-title"></p><p class="flatmin-percentage"></p><p class="flatmin-value"></p></div>');n.append('<div class="ratio"></div>').append(r);this.append(n);var i=n.width();resp(i,n);chart.total=totalValue(t);var s=0;e.each(t,function(t,r){var i={color:get_random_color()};if(typeof r[1]=="number"){sector={};sector.val=r[1];sector.per=r[1]/chart.total*100;sector.nm=r[0];sector.os=s;sector.color=r[2];var o=e.extend({},i,sector);paintChart(o,n);s+=360*sector.per/100}});return this};e.fn.getBackground=function(){var t="#FFF";e.each(this.parents(),function(n,r){console.log(r);var i=e(r).css("background-color");var s=i.indexOf("rgba");if(s==-1){t=i;return false}});return t}})(jQuery)